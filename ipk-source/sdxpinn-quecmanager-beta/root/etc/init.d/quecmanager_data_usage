#!/bin/sh /etc/rc.common
START=99
STOP=10
USE_PROCD=1

CONFIG_FILE="/etc/quecmanager/data_usage"

start_service() {
    # Check if data usage tracking is configured and enabled
    if [ ! -f "$CONFIG_FILE" ]; then
        echo "Data usage tracking not configured"
        return 0
    fi
    
    ENABLED=$(grep "^ENABLED=" "$CONFIG_FILE" 2>/dev/null | cut -d'=' -f2- | tr -d '"')
    if [ "$ENABLED" != "true" ]; then
        echo "Data usage tracking disabled"
        return 0
    fi
    
    echo "Starting Data Usage Backup Daemon..."
    
    procd_open_instance
    procd_set_param command /www/cgi-bin/quecmanager/experimental/data_usage_tracking/backup_daemon.sh
    procd_set_param respawn
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_set_param pidfile /var/run/data_usage_backup.pid
    procd_close_instance
    
    echo "Data Usage Backup Daemon started"
}

stop_service() {
    echo "Stopping Data Usage Backup Daemon..."
}

reload_service() {
    stop
    start
}